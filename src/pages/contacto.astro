---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Button from '../components/Button.astro';
---

<BaseLayout
  title="Contacto | Equitracción"
  description="Contacta con Equitracción para servicios forestales, desarrollo personal o formación en tracción animal. Respuesta en 48 horas."
  mode="hybrid"
>
  <Header mode="hybrid" />

  <main class="mode-hybrid">
    <!-- Hero -->
    <section class="bg-gradient-to-br from-[rgb(var(--color-brand-primary))] to-[rgb(var(--color-b2c-primary))] text-white py-20">
      <div class="max-w-4xl mx-auto px-6 lg:px-16 text-center">
        <h1 class="font-heading font-bold text-5xl md:text-6xl mb-6">
          Hablemos
        </h1>
        <p class="text-xl md:text-2xl text-white/90">
          El primer paso es una conversación. Te respondemos en 48 horas.
        </p>
      </div>
    </section>

    <!-- Formularios y contacto directo -->
    <section class="py-24 bg-white">
      <div class="max-w-7xl mx-auto px-6 lg:px-16">
        <div class="grid lg:grid-cols-2 gap-16">
          <!-- Formulario -->
          <div>
            <h2 class="font-heading font-bold text-3xl mb-8 text-[rgb(var(--color-text-primary))]">
              Envíanos un mensaje
            </h2>

            <form id="contact-form" class="space-y-6">
              <!-- Honeypot field - hidden from humans, visible to bots -->
              <input
                type="text"
                name="website"
                id="contact-honeypot"
                tabindex="-1"
                autocomplete="off"
                style="position: absolute; left: -9999px; width: 1px; height: 1px;"
                aria-hidden="true"
              />
              <!-- Nombre -->
              <div>
                <label for="nombre" class="block font-semibold mb-2 text-[rgb(var(--color-text-primary))]">
                  Nombre completo *
                </label>
                <input
                  type="text"
                  id="nombre"
                  name="nombre"
                  required
                  class="w-full px-4 py-3 border border-[rgb(var(--color-gray-light))] rounded-lg focus:outline-none focus:border-[rgb(var(--color-brand-primary))] transition-colors"
                  placeholder="Tu nombre"
                />
              </div>

              <!-- Email -->
              <div>
                <label for="email" class="block font-semibold mb-2 text-[rgb(var(--color-text-primary))]">
                  Email *
                </label>
                <input
                  type="email"
                  id="email"
                  name="email"
                  required
                  class="w-full px-4 py-3 border border-[rgb(var(--color-gray-light))] rounded-lg focus:outline-none focus:border-[rgb(var(--color-brand-primary))] transition-colors"
                  placeholder="tu@email.com"
                />
              </div>

              <!-- Teléfono -->
              <div>
                <label for="telefono" class="block font-semibold mb-2 text-[rgb(var(--color-text-primary))]">
                  Teléfono
                </label>
                <input
                  type="tel"
                  id="telefono"
                  name="telefono"
                  class="w-full px-4 py-3 border border-[rgb(var(--color-gray-light))] rounded-lg focus:outline-none focus:border-[rgb(var(--color-brand-primary))] transition-colors"
                  placeholder="+34 600 000 000"
                />
              </div>

              <!-- Asunto -->
              <div>
                <label for="asunto" class="block font-semibold mb-2 text-[rgb(var(--color-text-primary))]">
                  Asunto *
                </label>
                <input
                  type="text"
                  id="asunto"
                  name="asunto"
                  required
                  class="w-full px-4 py-3 border border-[rgb(var(--color-gray-light))] rounded-lg focus:outline-none focus:border-[rgb(var(--color-brand-primary))] transition-colors"
                  placeholder="¿De qué quieres hablarnos?"
                />
              </div>

              <!-- Tipo de consulta -->
              <div>
                <label for="tipo" class="block font-semibold mb-2 text-[rgb(var(--color-text-primary))]">
                  ¿En qué estás interesado? *
                </label>
                <select
                  id="tipo"
                  name="tipo"
                  required
                  class="w-full px-4 py-3 border border-[rgb(var(--color-gray-light))] rounded-lg focus:outline-none focus:border-[rgb(var(--color-brand-primary))] transition-colors bg-white"
                >
                  <option value="">Selecciona una opción</option>
                  <option value="forestales">Servicios Forestales (B2B)</option>
                  <option value="desarrollo">Desarrollo Personal</option>
                  <option value="formacion">Formación en Tracción Animal</option>
                  <option value="general">Otro</option>
                </select>
              </div>

              <!-- Mensaje -->
              <div>
                <label for="mensaje" class="block font-semibold mb-2 text-[rgb(var(--color-text-primary))]">
                  Mensaje *
                </label>
                <textarea
                  id="mensaje"
                  name="mensaje"
                  rows="6"
                  required
                  class="w-full px-4 py-3 border border-[rgb(var(--color-gray-light))] rounded-lg focus:outline-none focus:border-[rgb(var(--color-brand-primary))] transition-colors resize-none"
                  placeholder="Cuéntanos qué necesitas o qué te gustaría explorar..."
                ></textarea>
              </div>

              <!-- Messages -->
              <div id="form-messages" class="hidden"></div>

              <!-- Submit -->
              <button
                type="submit"
                id="submit-btn"
                class="w-full text-lg px-8 py-3 bg-[rgb(var(--color-brand-primary))] text-white font-semibold rounded-[var(--radius-md)] hover:bg-[rgb(var(--color-b2b-primary))] transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <span id="submit-text">Enviar mensaje</span>
                <span id="submit-loading" class="hidden">Enviando...</span>
              </button>

              <p class="text-sm text-[rgb(var(--color-gray-medium))]">
                * Campos obligatorios. Tus datos se tratan con confidencialidad según nuestra
                <a href="/privacidad" class="text-[rgb(var(--color-brand-primary))] hover:underline">política de privacidad</a>.
              </p>
            </form>
          </div>

          <!-- Información de contacto -->
          <div>
            <h2 class="font-heading font-bold text-3xl mb-8 text-[rgb(var(--color-text-primary))]">
              Otras formas de contacto
            </h2>

            <div class="space-y-8">
              <!-- Teléfono -->
              <div class="flex items-start">
                <div class="flex-shrink-0 w-12 h-12 rounded-lg bg-[rgb(var(--color-brand-primary))] flex items-center justify-center mr-4">
                  <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                  </svg>
                </div>
                <div>
                  <h3 class="font-semibold text-xl mb-2 text-[rgb(var(--color-text-primary))]">Teléfono / WhatsApp</h3>
                  <a href="tel:+34681298028" class="text-lg text-[rgb(var(--color-brand-primary))] hover:underline">
                    +34 681 298 028
                  </a>
                  <p class="text-[rgb(var(--color-gray-medium))] mt-1">
                    Lunes a viernes, 9:00 - 18:00h
                  </p>
                </div>
              </div>

              <!-- Email -->
              <div class="flex items-start">
                <div class="flex-shrink-0 w-12 h-12 rounded-lg bg-[rgb(var(--color-brand-primary))] flex items-center justify-center mr-4">
                  <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                  </svg>
                </div>
                <div>
                  <h3 class="font-semibold text-xl mb-2 text-[rgb(var(--color-text-primary))]">Email</h3>
                  <a href="mailto:info@equitraccion.com" class="text-lg text-[rgb(var(--color-brand-primary))] hover:underline">
                    info@equitraccion.com
                  </a>
                  <p class="text-[rgb(var(--color-gray-medium))] mt-1">
                    Respuesta en 48 horas
                  </p>
                </div>
              </div>

              <!-- Ubicación -->
              <div class="flex items-start">
                <div class="flex-shrink-0 w-12 h-12 rounded-lg bg-[rgb(var(--color-brand-primary))] flex items-center justify-center mr-4">
                  <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                  </svg>
                </div>
                <div>
                  <h3 class="font-semibold text-xl mb-2 text-[rgb(var(--color-text-primary))]">Ubicación</h3>
                  <p class="text-lg text-[rgb(var(--color-gray-medium))]">
                    Talaveruela de la Vera, Cáceres<br />
                    Extremadura, España
                  </p>
                </div>
              </div>

              <!-- Redes sociales -->
              <div class="flex items-start">
                <div class="flex-shrink-0 w-12 h-12 rounded-lg bg-[rgb(var(--color-brand-primary))] flex items-center justify-center mr-4">
                  <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M22.23 5.924c-.736.326-1.527.547-2.357.646.847-.508 1.498-1.312 1.804-2.27-.793.47-1.671.812-2.606.996A4.096 4.096 0 0016.077 4c-2.266 0-4.103 1.837-4.103 4.103 0 .322.036.635.106.935-3.41-.171-6.433-1.804-8.457-4.287-.353.607-.556 1.312-.556 2.064 0 1.424.724 2.679 1.825 3.415-.672-.021-1.305-.206-1.859-.513v.052c0 1.988 1.414 3.647 3.292 4.023-.344.094-.707.144-1.081.144-.265 0-.522-.026-.773-.074.522 1.63 2.038 2.816 3.833 2.85-1.404 1.1-3.174 1.756-5.096 1.756-.331 0-.658-.019-.979-.057 1.816 1.164 3.973 1.843 6.29 1.843 7.547 0 11.675-6.252 11.675-11.675 0-.178-.004-.355-.012-.531.802-.579 1.498-1.302 2.048-2.127z"/>
                  </svg>
                </div>
                <div>
                  <h3 class="font-semibold text-xl mb-2 text-[rgb(var(--color-text-primary))]">Redes Sociales</h3>
                  <div class="flex gap-4 mt-2">
                    <a href="https://www.facebook.com/EQUITRACCION" target="_blank" rel="noopener noreferrer" class="text-[rgb(var(--color-brand-primary))] hover:text-[rgb(var(--color-b2b-primary))] transition-colors">
                      Facebook
                    </a>
                    <a href="https://www.instagram.com/equitraccion" target="_blank" rel="noopener noreferrer" class="text-[rgb(var(--color-brand-primary))] hover:text-[rgb(var(--color-b2b-primary))] transition-colors">
                      Instagram
                    </a>
                    <a href="https://www.youtube.com/@equitraccion" target="_blank" rel="noopener noreferrer" class="text-[rgb(var(--color-brand-primary))] hover:text-[rgb(var(--color-b2b-primary))] transition-colors">
                      YouTube
                    </a>
                  </div>
                </div>
              </div>
            </div>

            <!-- Tiempo de respuesta -->
            <div class="mt-12 p-6 bg-[rgb(var(--color-beige-linen))] rounded-xl">
              <h3 class="font-heading font-semibold text-xl mb-3 text-[rgb(var(--color-text-primary))]">
                ¿Qué esperar?
              </h3>
              <ul class="space-y-2 text-[rgb(var(--color-gray-medium))]">
                <li class="flex items-start">
                  <svg class="w-5 h-5 mr-2 mt-0.5 flex-shrink-0 text-[rgb(var(--color-brand-primary))]" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                  </svg>
                  Respuesta en 48 horas (días laborables)
                </li>
                <li class="flex items-start">
                  <svg class="w-5 h-5 mr-2 mt-0.5 flex-shrink-0 text-[rgb(var(--color-brand-primary))]" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                  </svg>
                  Primera conversación sin compromiso
                </li>
                <li class="flex items-start">
                  <svg class="w-5 h-5 mr-2 mt-0.5 flex-shrink-0 text-[rgb(var(--color-brand-primary))]" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                  </svg>
                  Propuesta personalizada según tus necesidades
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <Footer />
</BaseLayout>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('contact-form') as HTMLFormElement;
    const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;
    const submitText = document.getElementById('submit-text') as HTMLSpanElement;
    const submitLoading = document.getElementById('submit-loading') as HTMLSpanElement;
    const formMessages = document.getElementById('form-messages') as HTMLDivElement;

    if (!form) {
      console.error('Form not found');
      return;
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      console.log('Form submitted');

      // Disable submit button
      submitBtn.disabled = true;
      submitText.classList.add('hidden');
      submitLoading.classList.remove('hidden');
      formMessages.classList.add('hidden');

      // Get form data
      const formData = new FormData(form);
      const data = {
        name: formData.get('nombre') as string,
        email: formData.get('email') as string,
        phone: (formData.get('telefono') as string) || undefined,
        subject: formData.get('asunto') as string,
        message: formData.get('mensaje') as string,
        category: formData.get('tipo') as string,
        honeypot: formData.get('website') as string,
      };

      console.log('Sending data:', data);

      try {
        const response = await fetch('/api/contact', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        });

        console.log('Response status:', response.status);

        const result = await response.json();
        console.log('Response data:', result);

        if (response.ok) {
          // Success
          formMessages.innerHTML = `
            <div class="p-4 bg-green-50 border border-green-200 rounded-lg text-green-800">
              <p class="font-semibold">✓ Mensaje enviado correctamente</p>
              <p class="text-sm mt-1">Te responderemos en un máximo de 48 horas.</p>
            </div>
          `;
          formMessages.classList.remove('hidden');
          form.reset();
        } else {
          // Error
          formMessages.innerHTML = `
            <div class="p-4 bg-red-50 border border-red-200 rounded-lg text-red-800">
              <p class="font-semibold">✗ Error al enviar el mensaje</p>
              <p class="text-sm mt-1">${result.error || 'Por favor, inténtalo de nuevo.'}</p>
            </div>
          `;
          formMessages.classList.remove('hidden');
        }
      } catch (error) {
        console.error('Fetch error:', error);
        // Network error
        formMessages.innerHTML = `
          <div class="p-4 bg-red-50 border border-red-200 rounded-lg text-red-800">
            <p class="font-semibold">✗ Error de conexión</p>
            <p class="text-sm mt-1">No se pudo enviar el mensaje. Por favor, inténtalo de nuevo o contacta directamente por email.</p>
          </div>
        `;
        formMessages.classList.remove('hidden');
      } finally {
        // Re-enable submit button
        submitBtn.disabled = false;
        submitText.classList.remove('hidden');
        submitLoading.classList.add('hidden');
      }
    });
  });
</script>
